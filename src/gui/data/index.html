<!doctype html>
<html>
    <head>
            <meta http-equiv="X-UA-Compatible" content="IE=9;IE=10;IE=Edge,chrome=1"/>
            <style>
                .wrapper {
                    width: 170px; /* Set the size of the progress bar */
                    height: 170px;
                    z-index: 1200px;
                    position: absolute; /* Enable clipping */
                    clip: rect(0px, 150px, 150px, 75px); /* Hide half of the progress bar */
                    }
                    /* Set the sizes of the elements that make up the progress bar */
                .circle {
                    z-index: 1200px;
                    width: 130px;
                    height: 130px;
                    border: 10px solid #88C057;
                    border-radius: 93px;
                    position: absolute;
                    clip: rect(0px, 75px, 150px, 0px);
                    /* transition: transform  0.3s; */
                    /* transform: rotate(0deg); */
                    }
            </style>
            <style>
                body{
                    background: #2F374A;
                    width: 300px;
                    font-family: Arial, Helvetica, sans-serif;
                    font-size: 12px;
                    text-align: center;
                    padding-top: 10px;
                    color:#e0e0e0;
                    cursor:default;
                    overflow: hidden;
                    -webkit-touch-callout: none; /* iOS Safari */
                    -webkit-user-select: none; /* Safari */
                    -khtml-user-select: none; /* Konqueror HTML */
                    -moz-user-select: none; /* Firefox */
                        -ms-user-select: none; /* Internet Explorer/Edge */
                            user-select: none; /* Non-prefixed version, currently
                                                supported by Chrome and Opera */
                }
                /* Top */
                #myIP{
                    padding-bottom: 20px;
                   
                }
                .myIP{
                    opacity: 0.5;
                }
               
                /* Progress  */
                .progress_container{
                    width: 150px;
                    margin: auto;
                    height: 150px;
                    /* top:-130px; */
                    /* position: relative; */
                    /* z-index: 1200; */
                    margin-top: 18px;
                    margin-bottom: 15px;
                    /* background: red; */
                }

                
                #progress_pointer{
                    float: right;
                    font-size: 25px;
                    color:#ffffff;
                    font-weight: 700;
                    position: relative;
                    top:60px;
                    width:120px;
                    text-align: center;
                    right:15px;
                
                }

                .loader_shadow{
                    width: 130px;
                    margin: auto;
                    position: absolute;
                    height: 130px;
                    z-index: 12;
                    left:83px;
                    top:50px;
                    /* background: blue; */
                    border-radius: 50%;
                    border: 10px solid rgba(0,0,0,0.1);

                }

                 
                 #choose{
                    float:right
                }
                
                .form{
                    /* padding-top: 10px; */
                    /* position: relative; */
                    /* top:20px; 
                */
                    
                    height: 30px;
                }
                
                .now_file{
                  color:#c4c4c4;
                  float: left; 
                }
                
                /* Direcory  */
                .directory_form{
                    /* padding-top: 30px; */
                    /* position: relative; */
                    /* top:20px; */
                    margin: auto;
                    width: 200px;
                    height: 15px;
                    margin-top: 35px;

                }
                .choosen_directory{
                    float: left;
                }
                
                .animate
                {
                    transition: all 0.1s;
                    -webkit-transition: all 0.1s;
                }
                .action_button{
                    cursor: pointer;
                    width:max-content;
                    display: inline;
                    user-select: none;
                    text-decoration: none;
                }
                .action_button:hover{
                    color: red;
                }
                .form_select{
                    color:#ffffff9d;
                    margin-top: 20px;
                    margin-left: -5px;
                }
                #select_ip{
                    width: 113px;
                    border-radius: 2.5px;
                    background: #c4c4c4;
                    margin-left: 10px;
                }
                
                #begin{
                    /* opacity: 0.3; */
                    margin-top: 30px;
                    
                }
                #begin_svg,
                #stop_svg,
                #break_svg,
                #loader{
                    display: inline-block;
                    width: 50px;
                    height: 50px;
                    margin:auto;
                    /* transform: rotate(33deg);  */
                }
                .image_button{
                    width: 50px;
                    height: 50px;
                }
                #stop_svg,
                #loader,
                #break_svg{
                    display: none;
                }
                #loader{
                    margin-top: -2.5px;
                    transform: rotate(20deg); 
                }
                #circleLoader,
                #circleLoader2{
                    transform: rotate(0deg); 
                }
               
                .active_button{
                    transition: all 0.1s ease-in-out;
                    cursor: pointer;
                    opacity: 0.9;
                    height: 30px;
                    width: 30px;
                }
                .active_button:hover{
                    opacity: 1
                }
                .active_button:active{
                    box-shadow: none;
                    opacity: 0.7
                }
                #alert{
                    color:red;
                    text-align: center;
                    height: 15px;
                    margin-top: 10px;
                }
                .log{
                    max-height: 40px;
                    height: 40px;
                    text-align: left;
                    width:250px;
                    display: inline-block;
                    margin:auto;
                    opacity: 0.3;
                    overflow: hidden;
                }

                .dashboard{
                    opacity: 0.3;
                    width: 200px;
                    margin: auto;
                    position: relative;
                    top: 30px;
                }
                .dashboard_file{
                    float: left;
                }
                .dashboard_speed{
                    float:right
                }
                #reload_ips{
                    width:20px;
                    height: 20px;
                    display: inline;
                    position: relative;
                    top:4px;
                    left:5px;
                    cursor: pointer;
                    opacity: 0.6;
                }
                #reload_ips:hover{
                    opacity: 0.8;
                }
                #reload_ips:active{
                    opacity: 1;
                }
                .button_icon{
                    width:20px;
                    height: 20px;
                }

                #offer{
                    width: 315px;
                    height: 50px;
                    background: rgba(0,0,0,0.3);
                    text-align: left;
                    padding-left: 5px;
                    position: absolute;
                    left: 0px;
                    top:430px;
                    transition: top 0.1s ease-in-out;
                }
                #offer_body{
                    display: inline-block;
                    width: 70%;
                    height: 40px;
                    margin-top: 15px;
                }
                .offer_button{
                    display: inline-block;
                    position: relative;
                    width: 35px;
                    margin-right: 5px;
                    border: 1px solid rgba(255,255,255,0.5);
                    border-radius: 3px;
                    text-align: center;
                    opacity: 1;
                    position: relative;
                    left: -5px;
                }
                .offer_button:hover{
                    box-shadow: 0px 0px 15px 0px rgba(0,0,0,0.75);
                }
                #offer_yes{
                   background: rgba(248, 172, 31,0.7)
                }
                #offer_no{
                   
                }

                .offer_buttons{
                    display: inline-block;
                    height: 40px;
                    float: right;
                    margin-top: 15px;
                }
                
                </style>
    </head>
    <body>
           
            <div class="myIP">Your IP: <span id="myIP">127.0.0.1</span></div>
            <div class="loader_shadow"></div>
            <div class="progress_container">
                <div class="wrapper" data-anim="base wrapper" id="wrapper">
                    <div class="circle" data-anim="base left" id="circle_left"></div>
                    <div class="circle" data-anim="base right" id="circle_right"></div>
                </div>
                <div id="progress_pointer">
                    0%
                </div>
            </div>
           
            <div class="directory_form">
                <div class="choosen_directory">
                    Directory: <span id='choosen_directory'>none</span>
                </div>
                <div type="button" id="choose" class="action_button">
                    Choose!
                </div>
            </div>
    
            <div class='form'>
                <div class="form_select">
                    <span>Send to: </span>       
                    <select id="select_ip">
                         <option value="192.168.0.2">192.168.0.1</option>
                    </select>
                    <div id="reload_ips">
                        <svg class="button_icon" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="Capa_1" x="0px" y="0px" viewBox="0 0 28.265 28.265" style="enable-background:new 0 0 28.265 28.265;" xml:space="preserve" width="512px" height="512px">
                            <g>
                                    <path d="M14.133,28.265c-7.061,0-12.805-5.75-12.805-12.809c0-7.06,5.744-12.807,12.805-12.807c0.469,0,0.943,0.027,1.414,0.08   v-2.07c0-0.266,0.164-0.508,0.406-0.611c0.252-0.098,0.531-0.043,0.723,0.148l4.537,4.547c0.258,0.258,0.258,0.67,0,0.932   l-4.535,4.557c-0.193,0.188-0.473,0.246-0.725,0.143c-0.242-0.104-0.406-0.344-0.406-0.609V7.47   c-0.469-0.086-0.941-0.125-1.414-0.125c-4.473,0-8.113,3.639-8.113,8.111c0,4.471,3.641,8.113,8.113,8.113s8.111-3.643,8.111-8.113   c0-0.363,0.295-0.66,0.662-0.66h3.369c0.365,0,0.662,0.297,0.662,0.66C26.937,22.515,21.189,28.265,14.133,28.265z" fill="#FFFFFF"/>
                                    <g>
                                    </g>
                            </g>
                        </svg>
                     </div>
                </div>
            
                <div id="alert"></div>
                </div>
                <div  id="begin">
                    <div id="begin_svg" onclick="offerLoad()" title="Start or continue">
                        <svg class="active_button" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="Capa_1" x="0px" y="0px" viewBox="0 0 232.153 232.153" style="enable-background:new 0 0 232.153 232.153;" xml:space="preserve" width="512px" height="512px">
                            <g id="Play">
                                <path style="fill-rule:evenodd;clip-rule:evenodd;" d="M203.791,99.628L49.307,2.294c-4.567-2.719-10.238-2.266-14.521-2.266   c-17.132,0-17.056,13.227-17.056,16.578v198.94c0,2.833-0.075,16.579,17.056,16.579c4.283,0,9.955,0.451,14.521-2.267   l154.483-97.333c12.68-7.545,10.489-16.449,10.489-16.449S216.471,107.172,203.791,99.628z" fill="#FFFFFF"/>
                            </g>
                        </svg> 
                    </div>
                    <div id="stop_svg" onclick="stopLoad()" title="Pause">
                        <svg  class="active_button" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="Capa_1" x="0px" y="0px" viewBox="0 0 232.679 232.679" style="enable-background:new 0 0 232.679 232.679;" xml:space="preserve" width="512px" height="512px">
                            <g id="Pause">
                                <path style="fill-rule:evenodd;clip-rule:evenodd;" d="M80.543,0H35.797c-9.885,0-17.898,8.014-17.898,17.898v196.883   c0,9.885,8.013,17.898,17.898,17.898h44.746c9.885,0,17.898-8.013,17.898-17.898V17.898C98.44,8.014,90.427,0,80.543,0z M196.882,0   h-44.746c-9.886,0-17.899,8.014-17.899,17.898v196.883c0,9.885,8.013,17.898,17.899,17.898h44.746   c9.885,0,17.898-8.013,17.898-17.898V17.898C214.781,8.014,206.767,0,196.882,0z" fill="#FFFFFF"/>
                            </g>
                        </svg>
                    </div>
                    <div  id="break_svg" onclick="breakLoad()" title="Cancel upload">
                        <svg class="active_button" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="Capa_1" x="0px" y="0px" viewBox="0 0 232.679 232.679" style="enable-background:new 0 0 232.679 232.679;" xml:space="preserve" width="512px" height="512px">
                            <g id="Stop">
                                <path style="fill-rule:evenodd;clip-rule:evenodd;" d="M214.781,0H17.898C8.013,0,0,8.014,0,17.898v196.883   c0,9.885,8.013,17.898,17.898,17.898h196.883c9.886,0,17.898-8.013,17.898-17.898V17.898C232.679,8.014,224.666,0,214.781,0z" fill="#FFFFFF"/>
                            </g>
                        </svg>
                    </div>

                    <div id="loader">
                            <svg viewBox="0 0 50 45"  id="circleLoader" -ms-transform-origin="25px 22px">
                                    <g>
                                      <circle   cx="25" cy="22.5" r="20" -ms-transform-origin="25px 22px"
                                      style="fill:rgba(0,0,0,0);stroke: #88C057; stroke-width: 2; stroke-dasharray: 10, 5;" />
                                      <circle  cx="25" cy="22.5" r="8" -ms-transform-origin="25px 22px" 
                                      style="fill:rgba(0,0,0,0);stroke: #88C057; stroke-width: 2; stroke-dasharray: 10, 5;" />
                                
                                    </g>
                                  </svg>
                    </div>
            
                </div>
                <div class="dashboard">
                    <div class="dashboard_file" id="dash_file">
                         ...
                    </div>
                    <div class="dashboard_speed" id="dash_speed">
                        0 B/s
                    </div>
                </div>
                <!-- <div class="log" id="log"></div>      -->
                
                <div id="offer">
                    <div id="offer_body">
                        192.168.255.255:123456 - offer transit directory "ass"
                    </div>
                    <div class="offer_buttons">
                        <div id="offer_yes" class="offer_button">
                            Yes
                        </div>
                        <div id="offer_no" class="offer_button">
                            No
                        </div>
                    </div>
                    </div>
                    
                </div>
            <!--Disable F5 reload  -->
            <script>
                document.onkeydown = function() 
                {
                    switch (event.keyCode) 
                    {
                        case 116 : //F5 button
                            event.returnValue = false;
                            event.keyCode = 0;
                            return false;
                        case 82 : //R button
                            if (event.ctrlKey) 
                            {
                                event.returnValue = false;
                                event.keyCode = 0;
                                return false;
                            }
                    }
                }

            </script>
            <script>
                window.transData = {path: "d:/129/788"};
            </script>
            <!-- Animation -->
            <script>
            "use strict";

            /* CONSTANTS */
            var initialTheta = 0; // The initial rotation angle, in degrees.
            var thetaDelta = 4; // The amount to rotate the square about every 16.7 milliseconds, in degrees.
            var angularLimit = 90; // The maximum number of degrees to rotate the square.
            var circleLoader = document.getElementById("circleLoader");
            var circleLoader2 = document.getElementById("circleLoader2");

            var now  = initialTheta
            function doAnim() {
                if(now>=360){
                    now = 0
                }

                circleLoader.style['-ms-transform'] = "rotate(" + now + "deg)"
                 now += thetaDelta; 
                 sleep(10, doAnim)
            }

            doAnim()

            function sleep (time, resolve) {
                    (function (resolve) {
                        setTimeout(function () { 
                            resolve();
                        },time)
                    })(resolve)
                }  


            var requestAnimationFrameID 
            function StartLoaderAnimation(){
                // requestAnimationFrameID = requestAnimationFrame(doAnim)
            }

            function StopLoaderAnimation(){
                // cancelAnimationFrame(requestAnimationFrameID)
            }

            circleLoader.currentTheta = initialTheta; // The initial rotation angle to use when the animation starts, stored in a custom property.

         
            </script>
            <!-- Dashboard Control -->
            <script>
                var interval
                var fileEl = document.getElementById("dash_file")
                var speedEl = document.getElementById("dash_speed")
                function beginRefreshDashboard(){
                    clearInterval(interval)
                    interval = setInterval(function(){
                        window.external.invoke("getDashboardData")
                    }, 1000);
                }

                function stopRefreshDashboard(){
                    clearInterval(interval)
                }

                function clearDashBoard(){
                    fileEl.innerHTML = "..."
                    speedEl.innerHTML = "0 B/s"
                }

                function refreshDashboard(file, speed){
                    if(file.length >= 14){
                        file = file.substr(file.length-14, file.length-1)
                    }
                    var suffix = " B/s"
                    switch (true) {
                        case speed>1048576:
                            speed = speed/1048576
                            suffix = " Mb/s"
                            break
                        case speed>1024:
                            speed = speed/1024
                            suffix = " Kb/s"
                            break
                    }
                    speed = Math.round( speed * 10 ) / 10
                    fileEl.innerHTML = file
                    speedEl.innerHTML = speed+suffix
                    
                }
            </script>
            <!-- Loaders script -->
            <script>
                var alertEl = document.getElementById("alert")
                var beginEl = document.getElementById("begin_svg")
                var stopEl = document.getElementById("stop_svg")
                var breakEl = document.getElementById("break_svg")
                var loaderEl = document.getElementById("loader")
                
                var uploadNow = false

                function offerLoad(){
                    if (uploadNow){
                        window.external.invoke("continueUpload")
                        beginEl.style.display = 'none'
                        stopEl.style.display = 'inline-block'
                        beginRefreshDashboard()
                        return
                    }
                    var ip = document.getElementById("select_ip").value;
                    if(window.transData.path=="none"){
                        alertEl.innerHTML="Choose directory"
                    }else if(!ip){
                        alertEl.innerHTML="Choose reciever"
                    }else{
                        alertEl.innerHTML=""
                        beginEl.style.display = 'none'
                        StartLoaderAnimation()
                        loaderEl.style.display = "inline-block"
                        
                        window.external.invoke('startLoad:{"path": "'+window.transData.path+'", "ip": "'+ip +'"}')
                    }
                }

                function stopLoad(){
                    window.external.invoke("stopUpload")
                    stopEl.style.display = 'none'
                    beginEl.style.display = 'inline-block'
                    stopRefreshDashboard()

                }

                function breakLoad(){
                    window.external.invoke("breakUpload")
                    stopRefreshDashboard()
                    clearDashBoard()
                    uploadNow = false
                    stopEl.style.display = 'none'
                    breakEl.style.display = 'none'
                    beginEl.style.display = 'inline-block'
                }

                function offerAccepted(){
                    uploadNow = true
                    StopLoaderAnimation()
                    
                    loaderEl.style.display = "none"
                    stopEl.style.display = 'inline-block'
                    breakEl.style.display = 'inline-block'
                    beginRefreshDashboard()
                }

                function offerCanceled(reason){
                    alertEl.innerHTML = reason
                    loaderEl.style.display = "none"
                    beginEl.style.display = 'inline-block'
                }

            </script>
            <!-- New Transit Offers -->
            <script>    

                var offer = document.getElementById("offer")
                var offer_body = document.getElementById("offer_body")
                var offer_yes = document.getElementById("offer_yes")
                var offer_no = document.getElementById("offer_no")
                

                offer_yes.addEventListener('click', function(){
                    window.external.invoke('acceptTransitOffer:'+offersSequence[offersSequence.length - 1].IP);
                    next();
                })
                
                offer_no.addEventListener('click', function(){
                    window.external.invoke('cancelTransitOffer:'+offersSequence[offersSequence.length - 1].IP);
                    next();
                })

                var offersSequence = []
                var subscribers = []

                function subscribeToOffers(func){
                    subscribers.push(func)
                }

                function unsubscribe(func){
                    // subscribers.pop(subscribers.indexOf(func))
                    subscribers.splice(subscribers.indexOf(func), 1);
                }

                function offersPush(offer){

                    offersSequence.push(offer)
                    if(offersSequence.length == 1){
                        window.external.invoke('dialoginfo:New transit offer')
                        subscribers.forEach(function(func){
                            func(offersSequence[0])
                        })
                    }
                   
                }

                function next(){
                    offer.style.top = '430px'

                    if(offersSequence.length==0){return}
                    offersSequence.splice(0, 1);
                    if(offersSequence.length > 0){
                        subscribers.forEach(function(func){
                            func(offersSequence[0])
                        })
                    }
                }

                subscribeToOffers(function(lastOffer){
                    offer_body.innerHTML = lastOffer.text
                    offer.style.top = '380px'
                    
                })

            </script>
            <script>
               




                document.getElementById('choose').addEventListener("click", chooseFunc);
                document.getElementById("reload_ips").addEventListener("click", reloadConnectedIPs)
                
                reloadConnectedIPs()
              
                window.external.invoke('myIP')

                
                var last_fin = 0;
                
                function reloadConnectedIPs(){
                    window.external.invoke('getConnectedIPs')    
                }

                function redrawIPs(ips){
                    let selector = document.getElementById('select_ip')
                    selector.innerHTML = ""
                    let newEl;
                    ips.forEach(function(element){
                        newEl = document.createElement('option')
                        newEl.value = element
                        newEl.innerText = element.split(':')[0]
                        selector.appendChild(newEl)
                    });
                }
                
                function progress(val){
                    var fin = 3.6* val
                    if(fin>180){
                        document.getElementById("circle_left").style.transform = "rotate(180deg)"
                        document.getElementById("circle_right").style.transform = "rotate("+fin+"deg)"
                        document.getElementById("wrapper").style.clip="rect(auto,auto,auto,auto)" 
                        last_fin = fin;
                        
                    }else{
                        document.getElementById("wrapper").style.clip="rect(0px,150px,150px,75px)"
                        document.getElementById("circle_left").style.transform = "rotate("+fin+"deg)"
                        document.getElementById("circle_right").style.transform = "rotate(0deg)"
                        last_fin = fin;
                    }
                    document.getElementById('progress_pointer').innerHTML = val+"%"
                }

                function setMyIP(ip){
                    document.getElementById("myIP").innerHTML = ip
                }

                function setLog(log){
                    document.getElementById("log").innerHTML = log
                }
                
                function chooseFunc(){
                    window.external.invoke('opendir');
                    if(window.transData.path.length==0){
                        window.transData.path = "none"
                    }
                    var path =  window.transData.path
                    if(window.transData.path.length>=10){path = '...'+path.substr(path.length - 7)}
                    document.getElementById('choosen_directory').innerHTML = path;
                }

                function beginFunc(){
                    
                }


            </script>
    </body>
</html>